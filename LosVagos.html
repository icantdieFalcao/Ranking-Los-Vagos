<!DOCTYPE html>
<html lang="en">
<head>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        text-align: center;
        color: #ffffff;
        background-color: transparent; /* Define o fundo como transparente */
    }

    html {
        background-color: transparent; /* Garante que o fundo do HTML também seja transparente */
    }

    #formContainer {
        display: none; /* Esconde o formulário inicialmente */
    }

/* Centraliza o texto do placeholder */
#login {
    text-align: center; /* Centraliza o texto digitado no campo */
}

#login::placeholder {
    text-align: center; /* Centraliza o texto do placeholder */
    color: #aaa; /* Opcional: cor do placeholder */
}

/* Centraliza o formulário de login */
#loginForm {
    position: absolute;
    top: 50%; /* Centraliza verticalmente */
    left: 50%; /* Centraliza horizontalmente */
    transform: translate(-50%, -50%); /* Compensa o deslocamento */
    text-align: center;
    padding: 40px;
    width: 100%;
    max-width: 400px;
    background-color: transparent; /* Fundo transparente */
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Sombra leve */
    height: 55vh; /* Ocupa 55% da altura da tela */
}

    .small-input {
        width: 300px; /* Largura do campo de login */
        background-color: transparent; /* Fundo transparente para o input */
        border: 1px solid #fff; /* Opcional: Adiciona borda para melhor visibilidade */
        color: #ffffff; /* Define a cor do texto */
    }
	
    .hidden-fields {
      display: none;
    }
.help.wide {
  width: 200px; /* Ajuste o valor conforme necessário */
}
</style>
</head>
<body>
    <!-- Formulário de Login -->
    <div id="loginForm" class="container m-4 pl-4">
      <label for="login"></label>
      <input
        type="text"
        id="login"
        required
        class="input small-input"
        placeholder="Digite seu login"
      />
      <button id="loginButton" class="button is-primary" style="margin-top: 5px;">Entrar</button>
      <p
        class="error-message"
        id="loginErrorMessage"
        style="display: none; color: red;"
      >
        Login inválido.
      </p>
    </div>
<div id="formContainer">
  <form id="form" class="container m-4 pl-4" method="POST">
    <!-- Campos do formulário -->
    <div class="field" style="display: flex; justify-content: space-between;">
      <div style="flex: 1;">
        <label for="Nome" class="label">Nome</label>
        <div class="control">
          <input
            type="text"
            id="nome"
            class="input"
            name="Nome"
            required
            readonly
            style="width: 80%; text-align: center;" 
          />
        </div>
      </div>
     </div>   
<div class="field is-grouped is-centered">
  <div class="control">
    <label for="categories"></label>
    <select id="categories" multiple size="5" onchange="showFields()">
      <option value="ATM">ATM</option>
      <option value="Lojinha">Lojinha</option>
      <option value="Entorpecentes">Entorpecentes</option>
      <option value="Desmanche">Desmanche</option>
      <option value="Joalheira">Joalheira</option>
      <option value="Corrida">Corrida</option>
      <option value="Presenca">Presença em ação</option>
      <option value="Missao">Missão Semanal</option>
      <option value="Rotas">Rotas</option>
    </select>
  </div>
</div>

<div id="ATM-fields" class="hidden-fields">
  <div class="control">
    <label for="ATM-quantity" class="label">ATM</label>
    <input
      class="input"
      type="number"
      placeholder="Quantidade"
      name="ATM"
      min="0"
      style="width: 150px;"
    />
  </div>
</div>

<div id="Lojinha-fields" class="hidden-fields">
  <div class="control">
    <label for="Lojinha-quantity" class="label">Lojinha</label>
    <input
      class="input"
      type="number"
      placeholder="Quantidade"
      name="Lojinha"
      min="0"
      style="width: 150px;"
    />
  </div>
</div>

<div id="Entorpecentes-fields" class="hidden-fields">
  <div class="control">
    <label for="Entorpecentes-quantity" class="label">Entorpecentes</label>
    <input
      class="input"
      type="number"
      placeholder="Quantidade"
      name="Entorpecentes"
      min="0"
      style="width: 150px;"
    />
  </div>
</div>

<div id="Desmanche-fields" class="hidden-fields">
  <div class="control">
    <label for="Desmanche-quantity" class="label">Desmanche</label>
    <input
      class="input"
      type="number"
      placeholder="Quantidade"
      name="Desmanche"
      min="0"
      style="width: 150px;"
    />
  </div>
</div>

<div id="Joalheira-fields" class="hidden-fields">
  <div class="control">
    <label for="Joalheira-quantity" class="label">Joalheira</label>
    <input
      class="input"
      type="number"
      placeholder="Quantidade"
      name="Joalheira"
      min="0"
      style="width: 150px;"
    />
  </div>
</div>

<div id="Corrida-fields" class="hidden-fields">
  <div class="control">
    <label for="Corrida-quantity" class="label">Corrida</label>
    <input
      class="input"
      type="number"
      placeholder="Quantidade"
      name="Corrida"
      min="0"
      style="width: 150px;"
    />
  </div>
</div>

<div id="Presenca-fields" class="hidden-fields">
  <div class="control">
    <label for="Presenca-quantity" class="label">Presença</label>
    <input
      class="input"
      type="number"
      placeholder="Quantidade"
      name="Presenca"
      min="0"
      style="width: 150px;"
    />
  </div>
</div>

<div id="Missao-fields" class="hidden-fields">
  <div class="control">
    <label for="Missao-quantity" class="label">Missão Semanal</label>
    <input
      class="input"
      type="number"
      placeholder="Quantidade"
      name="Missao"
      min="0"
      style="width: 150px;"
    />
  </div>
</div>


<div id="Rotas-fields" class="hidden-fields">
  <div class="control">
    <label for="Rotas-quantity" class="label">Rotas</label>
    <input
      class="input"
      type="number"
      placeholder="Quantidade"
      name="Rotas"
      min="0"
      style="width: 150px;"
    />
  </div>
</div>


  
<!-- Campos lado a lado para materiais -->
<div class="container">
  <!-- Seção da Imagem e Link -->
  <div class="field is-grouped is-centered">
    <div class="control">
      <label for="Imagem" class="label">Imagem</label>
      <input
        class="input"
        type="file"
        id="imageUpload"
        name="Imagem"
        multiple
        accept="image/*" 
      />
      <p class="help">Por favor, tenha cuidado com o tamanho em MB da imagem.<br>Não se esqueça de incluir os comprovantes (prints).</p>
    </div>
    <div class="control">
      <label for="Arquivo" class="label">Link</label>
      <textarea
        class="textarea"
        name="Arquivo"
        rows="1"
        style="width: 300px;"
        placeholder="Link das imagens aqui..."
      ></textarea>
      <p class="help">Faltou upar algumas imagens? utilize o link.</p>
    </div>
  </div>

  <!-- Botão de Envio -->
  <div class="field has-text-centered">
    <div class="control">
      <button
        class="button is-primary"
        type="submit"
        id="submit-button"
      >
        Enviar
      </button>
    </div>
  </div>

  <!-- Mensagem de Confirmação -->
  <div
    id="message"
    style="
      display: none;
      margin: 20px;
      font-weight: bold;
      color: #000000; /* PRETO */
      padding: 8px;
      background-color: #f5f5dc; /* Bege */
      border-radius: 4px;
      border-color: #7fffd4; /* Aquamarine */
    "
  ></div>
</div>





<script>
// Sistema de Login
const validUsers = {
  "Test": { nome: "Seagal - 48352", ID: "<@1234551482091831378>" },
};

let loggedInUser = null; // Armazenar usuário logado

document.getElementById("loginButton").addEventListener("click", function () {
  const loginInput = document.getElementById("login").value.trim().toLowerCase(); // Força minúsculas
  const user = validUsers[loginInput];

  if (user) {
    loggedInUser = `${user.ID}`; // Concatena nome e ID
    document.getElementById("loginForm").style.display = "none";
    document.getElementById("formContainer").style.display = "block"; // Mostra o formulário
    document.getElementById("loginErrorMessage").style.display = "none"; // Oculta a mensagem de erro
    document.getElementById('nome').value = user.nome; // Preenche o campo "Nome"
  } else {
    document.getElementById("loginErrorMessage").textContent =
      "Usuário não encontrado. Tente novamente.";
    document.getElementById("loginErrorMessage").style.display = "block"; // Mostra mensagem de erro
  }
});
	
function showFields() {
  var selectedCategories = Array.from(document.getElementById('categories').selectedOptions).map(option => option.value);
  var allFields = document.querySelectorAll('.hidden-fields');

  allFields.forEach(function(field) {
    field.style.display = 'none';
  });

  selectedCategories.forEach(function(category) {
    document.getElementById(category.replace(/\s/g, '') + '-fields').style.display = 'block';
  });
}

	
document
  .getElementById("form")
  .addEventListener("submit", async function (e) {
    e.preventDefault(); // Previne o envio padrão do formulário

    const imageUpload = document.getElementById('imageUpload');
    const linkInput = document.querySelector('textarea[name="Arquivo"]');
    const messageElement = document.getElementById("message");

    // Verifica se o link está vazio e se nenhuma imagem foi selecionada
    if (linkInput.value.trim() === '' && imageUpload.files.length === 0) {
      messageElement.textContent = 'Por favor, envie uma imagem ou insira um link.';
      messageElement.style.display = 'block'; // Mostra a mensagem
      messageElement.style.backgroundColor = '#FFCCCB'; // Cor de fundo para erro
      messageElement.style.color = '#000000'; // Cor do texto
	  messageElement.style.textAlign = 'center'; // Centraliza o texto
	  messageElement.scrollIntoView({ behavior: 'smooth' });
      return; // Impede o envio do formulário
    }

    messageElement.style.display = 'none'; // Esconde a mensagem se o formulário for válido

    document.getElementById("submit-button").disabled = true;

    // Coleta os dados do formulário
    var formData = new FormData(this);
    var keyValuePairs = [];
    for (var pair of formData.entries()) {
      keyValuePairs.push(pair[0] + "=" + pair[1]);
    }

    var formDataString = keyValuePairs.join("&");

    // Exibir a mensagem de "Enviando..."
    messageElement.textContent = "Relatório da Facção em processamento. Por favor, aguarde...";
    messageElement.style.display = "block";
    messageElement.style.backgroundColor = "#FFFFE0"; /* Amarelo */
    messageElement.style.color = "#000000"; /* Preto */
	messageElement.style.textAlign = 'center';
	messageElement.scrollIntoView({ behavior: 'smooth' });

    try {
      // Envia os dados para o Google Apps Script
      const response = await fetch(
        "https://script.google.com/macros/s/AKfycbw7fuNG62Fwdl9hB9XP9xdz_gSmCo_0HYVFmROHkbNZGBfF1KX8HdtqXyeWM_Awv4gO/exec",
        {
          redirect: "follow",
          method: "POST",
          body: formDataString,
          headers: {
            "Content-Type": "application/x-www-form-urlencoded;charset=utf-8",
          },
        }
      );

      if (!response.ok) {
        throw new Error("Falha ao enviar para o Google Apps Script");
      }

      // Coleta dados para enviar ao webhook do Discord
      const Nome = formData.get("Nome");
      const Arquivo = formData.get("Arquivo");
          const materiais = [];
            if (formData.get("ATM")) materiais.push(`ATM: ${formData.get("ATM")}`);
            if (formData.get("Lojinha")) materiais.push(`Lojinha: ${formData.get("Lojinha")}`);
			if (formData.get("Joalheira")) materiais.push(`Joalheira: ${formData.get("Joalheira")}`);
            if (formData.get("Entorpecentes")) materiais.push(`Entorpecentes: ${formData.get("Entorpecentes")}`);
            if (formData.get("Corrida")) materiais.push(`Corrida: ${formData.get("Corrida")}`);
            if (formData.get("Desmanche")) materiais.push(`Desmanche: ${formData.get("Desmanche")}`);
			if (formData.get("Presenca")) materiais.push(`Presença em ação: ${formData.get("Presenca")}`);
			if (formData.get("Missao")) materiais.push(`Missão Semanal: ${formData.get("Missao")}`);
			if (formData.get("Rotas")) materiais.push(`Rotas: ${formData.get("Rotas")}`);

      // Preparando os dados para o webhook do Discord
      const webhookURL =
        "https://discord.com/api/webhooks/1317710193949413466/YWZ_Cp08OOIApLI7kXQR-sxLEKiKeJ9hNUjOYwlZ1uDf9X8ZmNN0sEOmN38AV--UeYiU";
const webhookData = new FormData();
webhookData.append(
  "content",
  `📥 **Relatório da Facção**\n- **Nome:** *${Nome}*\n- **Discord:** *${loggedInUser}*\n- **Link:**\n> -# **${Arquivo ? Arquivo : ""}**\n- **Materiais:** ${
    materiais.length > 0
      ? "\n> " + materiais.map((material) => "-# " + material).join("\n> ")
      : ""
  }\n-# ||**Passo ciência;**  <@&1315073510028218440>||` 
);

      // Adiciona as imagens (se fornecidas) como anexos ao webhook
      const imageFiles = document.getElementById("imageUpload").files;
      for (let i = 0; i < imageFiles.length; i++) {
        webhookData.append(`file${i}`, imageFiles[i]);
      }

      // Envia dados para o webhook do Discord
      const webhookResponse = await fetch(webhookURL, {
        method: "POST",
        body: webhookData,
      });

      if (!webhookResponse.ok) {
        throw new Error("Falha ao enviar. Possível que imagens são muito pesadas. Tente fazer o upload das imagens e utilizar o link.");
      }

      messageElement.textContent = "Relatório da Facção enviado com sucesso! Obrigado pela sua contribuição.";
      messageElement.style.backgroundColor = "#98FB98";
      messageElement.style.color = "#000000";
      messageElement.style.display = "block";
	  messageElement.style.textAlign = 'center';
	  messageElement.scrollIntoView({ behavior: 'smooth' });

      // Temporizador para esconder a mensagem após 3 segundos
      setTimeout(function () {
        messageElement.textContent = "";
        messageElement.style.display = "none";
      }, 3000);

      // Reinicia o formulário após o envio
    } catch (error) {
      messageElement.textContent = error.message;
      messageElement.style.backgroundColor = "#FFCCCB";
      messageElement.style.color = "#000000";
      messageElement.style.display = "block";
	  messageElement.scrollIntoView({ behavior: 'smooth' });


      // Temporizador
      setTimeout(function () {
        messageElement.textContent = "";
        messageElement.style.display = "none";
      }, 10000);
    } finally {
      document.getElementById("submit-button").disabled = false; // Habilita o botão de enviar novamente
    }
  });
</script>

</body>
</html>
